env:
  global:
  - REGISTRY_USERNAME=abstractj
  - REGISTRY=quay.io
  - secure: kYgaGPRfKSHd68xE+XFUMzvcxT+G5J5MMLGYQFEajOz5uRCite8AWYcT3F4qA402uS3arZVMcbbahcEZ8vajavB81L4XcMz+QDLNuq1HvoZe6WRBFXf3EpXlsAf+y34R6O6hMVFu7Zu7vMoVr1L/M7FV/EssroatEtDpmGrNZDSJNEBYUID72iCZndw7TICg3bSKfpvnS6TqcZH09iA8NuUHdIw8UPkhRrjUBG8ynQyXoVfcUR4GhrZYdwXukocUEtMWOxp7KJGlvnGtMf9OjWUCY7drdw0yKTF0z7dINFYZBG2aMjHATBRuTWqp52AVG488J3ugfANtVwDrBkDivrKaMGqnH63nP21lkNz/Bnp0ymYqRepA6vIaGyi9a7O6yrvhpJJrBCxIb7s9AImN+hW7hbrvsVUJLGH/iMZwYySDPAQjlQIRcSRnsMrQZBn6D2TLr+DNIz5jlkLbRQKUO1xHNOYCRykxZ79LFA2D3mifRSbjWVEz6xGyG5IFWHCI65HqhOK66k8+O9GFQFzXjyoz//DFAp2dBeRFau98kTp26woK4WeIBO9hUM5zsG4jM+Fn8z2p0nVDtiOhVF1o8U4/2KzSUEpgkkRfDwAyNAYMsqecHV7xv/qLiN0UtwmN9g9Q5aibgjP2+K4L1b3DyQSZ+FHnVELx+0qyisBaIa0=
  - secure: DuK7Ww7yiHdV9k1g9dWfKk0bxafHnWBDMX9uwEHcH39G3qvblDrsR8rMvQBW+05KdF2MHFnKnGXa/pyHdwJITiTcbwr+vtlVvAnfxcqwa5Mo1LC/OM+HyTy+vQFcd//hs6wV2DZrmTeIFc7Xa8/43BonO0oo/BBAP48JCvrj885hpXLZzSP31k9yyuwclnfRJIa9UcOYBIWFVmp/0aNWLGDH/nmuuFAzHi5iLY2Gh8Vwu0ZUn7646U7xTQ+re2mL6auUWM2u1TinxTURmU9eAO3wycUe/kpd0cPwZFJKTUD2TkB6tV92PPT5ZiAlsHuOoA9A+dwNaE/EfkAnLx7ogpCgv+ja388YweJLdcvat/87UituHmDWMFjWXSWXKUHhJHLtronfl6FXGweJPW+UuCrU4vGb/R0H6mXYzbV0UU2TW16tjVo+mp0NVsdXEMTESusKUJ3sIEPVSSscM7dUbQgLFWouMma62mktk2wSW6YDTGKM9MiwF0s5VFujBPkPpX6kXIhqRNeNDRPrT5RsZgQeI1GX/RouhYm1XIIOZalAWDcPJ6YCPC6eIUiqP3XETtKsIRbKhRvIrbiezWe0KpL6Vt4tZUSPSA/dVWxw3J79uyMOMoTsg0pxIpzjnGXUkN+PF/+ZOLnp1pNFTJTsPHm1vamYfNQ1sDGIBzrsc1w=
  - secure: tzocD0xQrZjpKmiYEFdXPOe+ds7oFlb0PkdPXw3LeVRW26DU8e40iYXMNh1/KC7aQK2GCIJ8QjpPVDqj62uglt37z71j7MP5hgRxtKk//V7U7PFbqhIolkTwhZjH26tbTijqTrmCbJIr9zAyrP+IXubIoSp6xvPQ1KBOd0Vo5SZZsEp0jMl8DFozuu0as4vyDNvJdOkpQW+nvNrQc9S6QMl83A/JbtMJvS2mAXpg1ToAMUVAjk99Ku9l6d1R6Q4oggUssu5gKVTxOFHeqMkQcx2izZgXbJxW/LOSayMHnhixkZjhsCeZmG1TvgTO6ZD1uDNktbHoNTexSD3Ap+PjJi8r+BlERiDSxAYATOL09B2W4dSUJ85hg97nHlv5gq5QgALH3sEvxr2/ApflTzQtuwQniyg9F0tV2gsVhNFYMDbvSIFbdtssl6mIPcz83wxecnKuK+JW6aOzSLvlL30TJj16xfA/Afmd1riO18b0wPPbQ0Qrr3a5nuYvyim1omIhsTGcQL+sHrm8BOLOuYfF8HmqK/YMVXV38L3M/54du/7uxeo/An/wkXDdzMWW0WdqUG0rRp0xrN6EpCzA+NktLO1fbGvpq1XGRP3Ed8PqJFXiP7baBgfK0r8mp1paCVaHPGfV9IBdup9aNQV4GIUoaFfQcFCfp0WwCVKxAGYtlgU=
services:
- docker
language: go
go:
- 1.10.2
install:
- go get -u github.com/golang/dep/cmd/dep
- go get github.com/mattn/goveralls
- go get -u github.com/client9/misspell/cmd/misspell
script:
- make test
- if ([[ ${TRAVIS_BRANCH} == "master" ]] && [[ ${TRAVIS_EVENT_TYPE} == "push" ]])
  || [[ -n ${TRAVIS_TAG} ]]; then NAME=GOOS=windows GOARCH=amd64 go build -o bin/keycloak-gatekeeper-windows-amd64.exe;
  NAME=GOOS=linux GOARCH=amd64 go build -o bin/keycloak-gatekeeper-linux-amd64; docker
  login -u ${REGISTRY_USERNAME} -p ${REGISTRY_TOKEN} ${REGISTRY}; VERSION=${TRAVIS_TAG:-latest}
  make docker-release; fi
- if ([[ ${TRAVIS_BRANCH} == "master" ]] && [[ ${TRAVIS_EVENT_TYPE} == "push" ]]);
  then go get github.com/mattn/goveralls; goveralls -service=travis-ci; make bench;
  fi
deploy:
  provider: releases
  skip_cleanup: true
  on:
    repo: abstractj/keycloak-gatekeeper
    tags: true
  api_key:
    secure: "${GITHUB_TOKEN}"
  file:
  - bin/keycloak-gatekeeper-windows-amd64.exe
  - bin/keycloak-gatekeeper-linux-amd64
